@[toc]

## 各种分布距离公式

#### Mutual information 公式

互信息描述了两个分布共有信息的度量，它是顺序不敏感的，$I(X,Y)=I(Y,X)$。
$$
\begin{split}
\mathrm{I}(X;Y) &= \mathrm{H}(X) - \mathrm{H}(X|Y) = \mathrm{H}(X) + \mathrm{H}(Y) - \mathrm{H}(X,Y) \\
&= \int{p(x) \log{\frac{1}{p(x)}} \mathrm{d}x} - \left( -\iint{p(x,y) \log{\frac{p(x,y)}{p(y)}} \mathrm{d}x \mathrm{d}y} \right) \\
&= \iint{p(x,y) \log{\frac{1}{p(x)}} \mathrm{d}x \mathrm{d}y} +
	\iint{p(x,y) \log{\frac{p(x,y)}{p(y)}} \mathrm{d}x \mathrm{d}y} \\
&= \iint{p(x,y) \log{\frac{p(x,y)}{p(x)p(y)}} \mathrm{d}x \mathrm{d}y} \\
&= \mathrm{D}_{KL}\left(\mathrm{P}(X,Y) \| \mathrm{P}(X) \mathrm{P}(Y) \right)
\end{split}
$$

其中
$$
\begin{split}
\mathrm{H}(X) &= \int{p(x)\log{\frac{1}{p(x)}} \mathrm{d}x} \\
&= -\int{p(x) \log{p(x)} \mathrm{d}x}
\end{split}
$$

#### WGAN的损失函数

总体表达式为：
$$
\mathop{\mathrm{min}}\limits_{G}\space \mathop{\mathrm{max}}\limits_{D}\space \mathrm{V}(D,G)=
\mathop{\mathrm{min}}\limits_{G}\space \mathop{\mathrm{max}}\limits_{D}\space [\mathrm{E}_{x\sim p_{data}}\log D(x)+\mathrm{E}_{z\sim p_z}\log(1-D(G(z)))]
$$

其中$x\sim p_{data}$为真实数据，$z\sim p_z$为随机噪声。

##### 判别器D：

可将D(x)的输出看作是判别x为真实样本的输出，即$D(x)=score \in (0,1)$。

判别器在真实样本上的损失，即$\operatorname{Crossentropy}(y_{pre}=D(x),y_{true}=1)$，输出score越高越好。
$$
Dloss_{real} = -\mathrm{E}_{x\sim p_{data}}\log(D(x))
$$
在生成样本上的损失，即$\operatorname{Crossentropy}(y_{pre}=D(x),y_{true}=0)$，其中$x=G(z),x\sim P_{G(z)}(x)$；输出score越低越好，即$1-score$越高越好。
$$
Dloss_{fake} = -\mathrm{E}_{x\sim p_G(x)}\log(1-D(x))
$$
判别器D的总损失为：
$$
\begin{split}
Dloss &= Dloss_{real} + Dloss_{fake} \\
&= -\mathrm{E}_{x\sim p_{data}}\log(D(x)) -\mathrm{E}_{x\sim p_G(x)}\log(1-D(x)) \\
&= -\mathrm{E}_{x\sim p_{data}}\log(D(x)) -\mathrm{E}_{z\sim p_z}\log(1-D(G(z)))
\end{split}
$$

##### 生成器G：

生成器生成样本尽可能与真实样本一样，即$\operatorname{Crossentropy}(y_{pre}=D(G(z)),y_{true}=1)$：
$$
Gloss_{real} = -\mathrm{E}_{z\sim p_z} \log(D(G(z)))
$$
另外一种表示形式，即$\operatorname{Crossentropy}(y_{pre}=D(G(z)),y_{true}=0)$：
$$
Gloss_{fake} = \mathrm{E}_{z\sim p_z} \log(1-D(G(z)))
$$
即有两种计算方法：

+ $\operatorname{Crossentropy}(y_{pre}=D(G(z)),y_{true}=1)$
+ $-\operatorname{Crossentropy}(y_{pre}=D(G(z)),y_{true}=0)$

##### WGAN-GP模型

需要在判别器上增加一个罚项。
$$
J(D)=E_{z\sim p_{z}}\bigl[D\bigl(G(z)\bigr)\bigr]-E_{x\sim p_{r}}\bigl[D(x)\bigr]+
	\lambda E_{\hat{x}\sim p_{\hat{x}}}\bigl[\bigl(\bigl|\nabla_{\hat{x}}D(\hat{x})\bigr|\bigr|_{2}-1)^{2}\bigr]
$$


## 专业名词的数学原理

##### PSNR（Peak Signal to Noise Ratio，峰值信噪比）

使用PSNR来表示载密图像与原始图像之间的差距
$$
PSNR=10log_{10}\frac{255^2}{MSE},\\
MSE=\frac{1}{M\times N}\sum^M_{i=1} \sum^N_{j=1}(P_{i,j}-P'_{i,j})^2
$$
其中*MSE*表示原始图像与载密图像之间的均方差，*M*和*N*代表图像长和宽，也就是说，PSNR计算的是原始图像与载密图像之间的像素值差异，PSNR越大，则载密图像与原始图像的差距越小，可逆信息隐藏算法的性能越好

##### UDIR（单位失真增长比）

综合考虑图像的视觉质量和文件扩展
$$
UDIR=\frac{PSNR\times L}{FE}
$$
其中分子是PSNR与嵌入附加信息长度的乘积，分母是文件扩展。*PSNR*和*L*越高或者*FE*越小，则*UDIR*越高，即算法越好



#### 移动平均(Moving Average)

##### 简单移动平均(Simple Moving Average, SMA)：

$$
SMA_t=\frac{P_1+P_2+...+P_n}{n}
$$
##### 加权移动平均(Weight Moving Average, WMA)：

从当前时间$t$到之前时间$t-T+1$的权重线性递减
$$
WMA_t=\frac{Ty_t+(T-1)y_{t-1}+\ldots+2y_{t-T+2}+y_{t-T+1}}{T(T+1)/2}
$$
##### 指数移动平均(Exponential Moving Average, EMA)：

相比于加权移动平均，各加权按指数递减
$$
EMA_t=\left\{
    \begin{matrix}
        y_1 &\text{t=1} \\
        \alpha y_t+(1-\alpha)EMA_{t-1} &\text{t>1}
    \end{matrix}
\right.
$$
其中$\alpha \in (1,0)$表示权重的衰减程度，$\alpha$越大表示过去的观测值衰减越快。

+ $y_t$表示某一时刻真实值
+ $EMA_t$表示$t$时刻指数移动平均值

初始时刻EMA的偏差很大，这里引入一个偏差修正公式（Bias correction in exponentially weighted averages）：
$$
EMA_t = \frac{EMA_t}{1-\alpha^t}
$$
